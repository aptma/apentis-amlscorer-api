openapi: 3.0.3
info:
  title: Apentis API
  version: 1.1.0
  description: |
    This API enables external systems — such as CRMs, onboarding tools, or custom platforms — to integrate securely with the Apentis platform.

    For full documentation, usage examples and changelogs, please see:
    [README on GitHub](https://github.com/aptma/apentis-amlscorer-api?tab=readme-ov-file#readme)

    ## Authentication

    All endpoints require authentication via a Bearer token. A Bearer token is a security token that grants access to protected resources. It must be included in the HTTP Authorization header of each API request. The server validates the token to authenticate the client making the request.

    Clients must include the following HTTP header with each API request:

    ```http
    Authorization: Bearer <your_token_here>
    ```

    ### How to obtain a token

    - API tokens are issued manually by Apentis during client onboarding.
    - Each token is associated with an organization and specific access permissions.
    - Tokens are long-lived but can be revoked at any time for security purposes.

    ### Security best practices

    - Store the token securely and do not expose it in public repositories or client-side code.
    - Rotate the token periodically if instructed by Apentis.
    - In case of token compromise, contact Apentis support immediately to revoke and regenerate a new token.

    ### Example of using the token in a request

    ```bash
    curl -X GET "https://api.apentis.com/business-relations" \
         -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    ```

    If the token is missing or invalid, the API will return a `401 Unauthorized` response.

  contact:
    name: Apentis
    email: support@apentis.com
    url: https://www.apentis.com/contact

servers:
  - url: https://api.apentis.com
    description: API for Production environment
  - url: https://www.rq-test.com/api
    description: API for Test environment (for sandbox integration)    

security:
  - bearerAuth: []

tags:
  - name: Business relations
    description: Operations related to managing business relations (clients, entities, individuals).
  - name: KYC documents
    description: Uploading, retrieving, and deleting KYC-related documents for business relations.
  - name: Business relation links
    description: Manage roles and relationships between two business relations (e.g., person to company).
  - name: AML/KYC results
    description: Access to the risk rating, acceptance status, PEP/sanction status, and document completeness of a business relation.
  - name: Investor commitments
    description: Endpoints related to investor fund commitments.
  - name: Cash transactions
    description: Endpoints for submitting and monitoring cash movements related to AML processes.

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    DocumentTypeEnum:
      type: string
      enum:
        - account_valuation
        - Acknowledgement of receipt
        - Advisory mandate contract
        - aml_letter
        - articles_of_incorporation
        - Bank account details
        - Bank statement
        - business_continuity_plan
        - Certificate of accommodation
        - Certificate of good standing 
        - certificate of incorporation
        - Certificate of incumbency
        - Certificate of insurance
        - Civil partnership certificate
        - Client acceptance doc
        - client_profile
        - Collateral agreement
        - Consumer loan agreement
        - Copy of transaction notices
        - Corporate structure
        - Criminal record
        - death_certificate
        - declaration_of_BO
        - deed
        - Discretionary mandate contract
        - Divorce judgment
        - Driving licence
        - Eligibility assessment
        - Employment certificate
        - Employment contract
        - End of relationship doc
        - Engagement letter
        - entering business relationship
        - Family record book
        - FATCA classification
        - Financial statement
        - Financing plan
        - general_conditions
        - Health insurance card
        - ID card scan
        - investment_profile
        - KYC Form
        - kyc_report
        - Life insurance contract
        - list_authorized_signatures
        - Management agreement
        - Marriage certificate
        - MIFID classification
        - MIFID form
        - Mortgage loan agreement
        - name_check
        - Others
        - Passport
        - Pay slip
        - Phone subscription
        - power_of_attorney
        - Proof of domicile
        - Proof of origin of capital
        - PV board of directors
        - PV general assembly
        - RCS
        - Register of beneficial owners
        - Register of directors
        - Register of shareholders
        - Resident card
        - RTO mandate contract
        - Separation agreement
        - Status
        - Tax notice
        - Tax registration number
        - termination_letter
        - Transaction record
        - Tripartite agreement
        - Unique Identification Number
        - utility_bill
        - visit_report

    BusinessRelation:
      type: object
      required:
        - type
        - name
        - crmCode
      properties:
        type:
          type: string
          enum: [Association, Company, Family, Foundation, Fund, Household, Insurance company, Insurance contract, Joint ownership, Partnership, Person, Trust]
          description: Type of business relation.
        name:
          type: string
          description: Full name of the person or organization.
        firstName:
          type: string
          description: Required if the type is Person.
        lastName:
          type: string
          description: Required if the type is Person.
        maidenName:
          type: string
          description: Person's maiden name. Optional.
        nationality:
          type: string
          maxLength: 2
          description: ISO 2-letter nationality code. Applicable for persons.
        fiscalCountry:
          type: string
          maxLength: 2
          description: ISO 2-letter fiscal country code.
        countryOfOperation:
          type: string
          maxLength: 2
          description: ISO 2-letter country of operation. Applicable for companies.
        address:
          type: string
          description: Street address of the business relation.
        postalCode:
          type: string
          description: Postal code of the business relation.
        city:
          type: string
          description: City of the business relation.
        countryOfResidence:
          type: string
          maxLength: 2
          description: ISO 2-letter country of residence. 
        language:
          type: string
          maxLength: 2
          description: Language code (ISO 639-1) of the business relation.
        birthDate:
          type: string
          format: date
          description: Date of birth of the person (YYYY-MM-DD). Optional.
        phoneNumber:
          type: string
          description: Phone number of the business relation. Optional.
        email:
          type: string
          format: email
          pattern: ^[\w\.-]+@[\w\.-]+\.\w{2,}$
          description: Email address. Optional. Must be a valid email format.
        relationshipStatus:
          type: string
          enum: [Client, Prospect, Contact, Investment]
          default: Client
          description: Business relation type.
        relationStatus:
          type: string
          enum: [active, terminated]
          default: active
          description: Status of the business relation.
        crmCode:
          type: string
          maxLength: 100
          description: Unique external identifier of the business relation from the calling system.

    InvestorCommitment:
      type: object
      required:
        - fundId
        - commitmentAmount
        - commitmentCurrency
        - commitmentDate
      properties:
        fundId:
          type: string
          maxLength: 100
          description: Unique identifier of the fund
        commitmentAmount:
          type: number
          format: double
          description: Amount committed to the fund
        commitmentCurrency:
          type: string
          pattern: "^[A-Z]{3}$"
          description: ISO 4217 currency code (e.g., EUR, USD)
        commitmentDate:
          type: string
          format: date
          description: Commitment date in YYYY-MM-DD format

    DocumentMetadata:
      type: object
      required:
        - documentName
        - documentType
      properties:
        documentName:
          type: string
          maxLength: 200
        documentType:
          $ref: '#/components/schemas/DocumentTypeEnum'
        issuanceDate:
          type: string
          format: date
          description: Date of issuance of the document (YYYY-MM-DD). Optional.
        expirationDate:
          type: string
          format: date
          description: Date of expiration of the document (YYYY-MM-DD). Optional.
        documentNumber:
          type: string
          maxLength: 30
          description: Document identification number (e.g., passport or ID card number).
        isCertifiedTrueCopy:
          type: boolean
          description: Indicates whether the uploaded document is a certified true copy.
        documentIssuer:
          type: string
          maxLength: 2
          description: ISO 2-letter country code of the country that has issued the document (e.g., 'US', 'FR').

    AmlKycResult:
      type: object
      properties:
        amlRiskRating:
          type: string
          enum: [low, medium, high]
          description: AML risk rating assigned to the business relation.
        relationAcceptanceStatus:
          type: string
          enum: [approved, restricted, rejected]
          description: Final decision on whether the business relation is accepted.
        isPep:
          type: boolean
          description: Whether the business relation is identified as a Politically Exposed Person (PEP).
        isSanctioned:
          type: boolean
          description: Whether the business relation appears on a sanctions list.
        kycStatus:
          type: string
          enum: [to review, reviewed]
          description: KYC review status of the business relation.
        lastKycReviewDate:
          type: string
          format: date
          description: Date of the most recent KYC review (YYYY-MM-DD).
        missingDocuments:
          type: array
          items:
            $ref: '#/components/schemas/DocumentTypeEnum'
          description: List of missing document types.
        expiredDocuments:
          type: array
          items:
            $ref: '#/components/schemas/DocumentTypeEnum'
          description: List of expired document types.

    BusinessRelationLink:
      type: object
      required:
        - linkedCrmCode
        - role
      properties:
        linkedCrmCode:
          type: string
          maxLength: 100
          description: The crmCode of the business relation to link (e.g., a person).
        role:
          type: string
          enum:
            - Director
            - Board member
            - Trustee
            - Protector
            - Settlor
            - Beneficiary of the trust
            - Key person
            - Corporate director
            - President
            - Treasurer
            - Secretary
            - General partner
            - Limited partner
            - Beneficial owner
            - Member
            - Shareholder
          description: The role of the linked business relation in relation to the main one. Please see the README file to see authorized links between entities.

    BusinessRelationLinkDeleteRequest:
        type: array
        items:
          type: object
          required:
            - linkedCrmCode
            - role
          properties:
            linkedCrmCode:
              type: string
              maxLength: 100
              description: The CRM code of the related business relation to unlink.
            role:
              type: string
              enum:
                - Director
                - Board member
                - Trustee
                - Protector
                - Settlor
                - Beneficiary of the trust
                - Key person
                - Corporate director
                - President
                - Treasurer
                - Secretary
                - General partner
                - Limited partner
                - Beneficial owner
                - Member
                - Shareholder
              description: Role to remove from the relationship.

    CashTransaction:
      type: object
      required:
        - crmCode
        - transactionDate
        - portfolioId
        - currency
        - amount
        - transactionType
        - externalTransactionId
      properties:
        crmCode:
          type: string
          maxLength: 100
          description: Business relation executing the transaction
        transactionDate:
          type: string
          format: date
          description: Transaction date in YYYY-MM-DD format
        valueDate:
          type: string
          format: date
          description: Date of value or settlement in YYYY-MM-DD format (optional)          
        portfolioId:
          type: string
          maxLength: 100
          description: Identifier of the account or portfolio
        currency:
          type: string
          pattern: "^[A-Z]{3}$"
          description: ISO 4217 currency code (e.g., EUR, USD)
        amount:
          type: number
          format: double
          description: Net cash amount of the transaction
        transactionType:
          type: string
          enum:
            - dividend
            - coupon
            - interest-payment
            - bond-reimbursement
            - forex
            - cash-transfer
            - fee
            - tax
            - time-deposit
            - loan
            - margin-call
            - capital-call
            - distribution
            - other
          description: Type of transaction
        transactionDirection:
          type: string
          enum: [inflow, outflow]          
        description:
          type: string
          maxLength: 200
          description: Optional free-text description
        externalTransactionId:
          type: string
          maxLength: 100
          description: Unique transaction ID from the external system
        originCountry:
          type: string
          maxLength: 2
          pattern: "^[A-Z]{2}$"
          description: ISO 2-letter country code of the transaction's origin (e.g., FR)
        originIban:
          type: string
          maxLength: 34
          description: IBAN of the originating bank account
        originatorName:
          type: string
          maxLength: 100
          description: Name of the counterparty sending the funds          
        destinationCountry:
          type: string
          maxLength: 2
          pattern: "^[A-Z]{2}$"
          description: ISO 2-letter country code of the transaction's destination (e.g., DE)
        destinationIban:
          type: string
          maxLength: 34
          description: IBAN of the beneficiary bank account
        beneficiaryName:
          type: string
          maxLength: 100
          description: Name of the counterparty receiving the funds
        complianceNote:
          type: string
          maxLength: 200
          description: Optional field from the back office with context or risk flag
        isInternalTransfer:
          type: boolean
          description: Indicates if the cash movement is internal (between client’s own portfolios)
        isSuspicious:
          type: boolean
          description: Optional pre-flag from source system if already suspected          

    CashFlowResult:
      type: object
      properties:
        externalTransactionId:
          type: string
        crmCode:
          type: string
        portfolioId:
          type: string
        transactionDate:
          type: string
          format: date
        analysisResult:
          type: object
          properties:
            status:
              type: string
              enum: [clear, flagged, pending-review]
            riskScore:
              type: integer
              minimum: 0
              maximum: 100
            riskLevel:
              type: string
              enum: [low, medium, high]
            automatedComment:
              type: string
            screeningHits:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  details:
                    type: string
        complianceReview:
          type: object
          properties:
            reviewedBy:
              type: string
            reviewDate:
              type: string
              format: date
            status:
              type: string
              enum: [approved, under_investigation, escalated, dismissed]
            comment:
              type: string

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Short description of the error
        code:
          type: integer
          description: Application-specific or HTTP error code
      example:
        error: "Internal Server Error"
        code: 500

paths:
  /v1.1/business-relations:
    post:
      summary: Create a new business relation
      tags:
        - Business relations
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessRelation'
            example:
              type: Person
              name: Anna Nowak
              firstName: Anna
              lastName: Nowak
              nationality: PL
              fiscalCountry: PL
              address: 12A Nowy Swiat
              postalCode: 80-145
              city: Warsaw
              countryOfResidence: PL
              language: EN
              birthDate: 1985-09-12
              phoneNumber: '+48 123 456 789'
              email: anna.nowak@example.com
              relationshipStatus: Client
              relationStatus: active
              crmCode: CUST-PL-2024-0001
      responses:
        '201':
          description: Business relation created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  crmCode:
                    type: string
                  status:
                    type: string
              example:
                crmCode: "CUST-PL-2024-0001"
                status: "created"
        '400':
          description: Bad Request - Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Bad Request - Invalid input"
                code: 400
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '409':
          description: Conflict - Already existing crmCode
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Conflict - Already existing crmCode"
                code: 409
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1.1/business-relations/{crmCode}:
    put:
      summary: Update an existing business relation
      tags:
        - Business relations
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: crmCode
          required: true
          schema:
            type: string
          description: Unique external identifier of the business relation.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessRelation'
            example:
              phoneNumber: "+352 456 789"
              email: claire.lefebvre@client.eu
      responses:
        '200':
          description: Business relation updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  crmCode:
                    type: string
                  status:
                    type: string
              example:
                crmCode: "EXT123456"
                status: "updated"
        '400':
          description: Bad Request - Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Bad Request - Invalid input"
                code: 400
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '404':
          description: Not Found - Business relation with specified crmCode not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Not Found - Business relation with specified crmCode not found"
                code: 404
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Retrieve a business relation by crmCode
      tags:
        - Business relations
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: crmCode
          required: true
          schema:
            type: string
          description: Unique external identifier of the business relation.
      responses:
        '200':
          description: Business relation retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessRelation'
              example:
                type: Person
                name: Anna Nowak
                firstName: Anna
                lastName: Nowak
                nationality: PL
                fiscalCountry: PL
                address: 12A Nowy Swiat
                postalCode: 80-145
                city: Warsaw
                countryOfResidence: PL
                language: EN
                birthDate: 1985-09-12
                phoneNumber: "+48 123 456 789"
                email: anna.nowak@example.com
                relationshipStatus: Client
                relationStatus: active
                crmCode: CUST-PL-2024-0001
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '404':
          description: Not Found - Business relation not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Not Found - Business relation with specified crmCode not found"
                code: 404
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1.1/business-relations/{crmCode}/documents:
    post:
      summary: Upload one or more documents and associated metadata
      tags:
        - KYC documents
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: crmCode
          required: true
          schema:
            type: string
          description: Unique external identifier of the business relation.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - files
                - metadata
              properties:
                files:
                  type: array
                  minItems: 1
                  items:
                    type: string
                    format: binary
                  description: |
                    One or more document files to upload (PDF, Word, etc.).

                    Example: [passport.pdf, proof_of_domicile.pdf]
                metadata:
                  type: string
                  description: |
                    JSON string representing an array of document metadata.
                    ⚠️ The number of metadata entries **must exactly match** the number of uploaded files in `files[]`.

                    Example:
                    ```json
                    [
                      {
                        "documentName": "Passport - Anna Nowak",
                        "documentType": "Passport",
                        "issuanceDate": "2019-05-01",
                        "expirationDate": "2029-05-01",
                        "documentNumber": "PA123456789",
                        "isCertifiedTrueCopy": true,
                        "documentIssuer": "PL"
                      },
                      {
                        "documentName": "Proof of Domicile - Anna Nowak",
                        "documentType": "Proof of domicile",
                        "issuanceDate": "2023-11-01",
                        "expirationDate": "2024-11-01",
                        "documentNumber": "DOM987654321",
                        "isCertifiedTrueCopy": false,
                        "documentIssuer": "PL"
                      }
                    ]
                    ```
            encoding:
              metadata:
                contentType: application/json
      responses:
        '201':
          description: Documents uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  uploadedDocumentsCount:
                    type: integer
                  status:
                    type: string
                    example: success
                example:
                  uploadedDocumentsCount: 2
                  status: success
        '400':
          description: Invalid input or metadata count mismatch
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Metadata count does not match number of uploaded files"
                code: 400
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '404':
          description: Not Found - Business relation not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Not Found - Business relation with specified crmCode not found"
                code: 404
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Retrieve documents associated with a business relation
      tags:
        - KYC documents
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: crmCode
          required: true
          schema:
            type: string
          description: Unique external identifier of the business relation.
      responses:
        '200':
          description: Documents retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentMetadata'
              example:
                - documentName: "Passport - Anna Nowak"
                  documentType: "Passport"
                  issuanceDate: "2020-04-10"
                  expirationDate: "2030-04-10"
                  documentNumber: "AA4538293"
                  isCertifiedTrueCopy: true
                  documentIssuer: "PL"
                - documentName: "Proof of domicile - Anna Nowak"
                  documentType: "Proof of domicile"
                  issuanceDate: "2024-01-05"
                  expirationDate: "2025-01-05"
                  documentNumber: "DOM-112233"
                  isCertifiedTrueCopy: false
                  documentIssuer: "PL"
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '404':
          description: Not Found - Business relation not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Not Found - Business relation with specified crmCode not found"
                code: 404
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete documents associated with a business relation
      tags:
        - KYC documents
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: crmCode
          required: true
          schema:
            type: string
          description: Unique external identifier of the business relation.
        - in: query
          name: documentType
          required: false
          schema:
            type: string
          description: If provided, only documents matching this type will be deleted.
      responses:
        '200':
          description: Documents deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  deletedDocumentsCount:
                    type: integer
                    description: Number of documents deleted
                  status:
                    type: string
                    example: "success"
              example:
                deletedDocumentsCount: 2
                status: "success"
        '400':
          description: Bad Request - Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Bad Request - Invalid input"
                code: 400
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '404':
          description: Not Found - Business relation or documents not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Not Found - Business relation with specified crmCode not found"
                code: 404
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  /v1.1/business-relations/{crmCode}/documents/metadata-only:
    post:
      summary: Submit document metadata without file
      tags:
        - KYC documents
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: crmCode
          required: true
          schema:
            type: string
          description: Unique external identifier of the business relation.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DocumentMetadata'
            example:
              documentName: "ID Card - Jean Dupont"
              documentType: "ID card scan"
              issuanceDate: "2019-05-01"
              expirationDate: "2029-05-01"
              documentNumber: "ID123456789"
              isCertifiedTrueCopy: true
              documentIssuer: "FR"
      responses:
        '201':
          description: Document metadata saved successfully
        '400':
          description: Bad Request - Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Bad Request - Invalid input"
                code: 400
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '404':
          description: Not Found - Business relation not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Not Found - Business relation with specified crmCode not found"
                code: 404
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1.1/business-relations/{crmCode}/links:
    post:
      summary: Link multiple business relations to a primary one
      tags:
        - Business relation links
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: crmCode
          required: true
          schema:
            type: string
          description: The primary business relation (e.g., a company).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/BusinessRelationLink'
            example:
              - linkedCrmCode: MZ001
                role: Director
              - linkedCrmCode: SH002
                role: Shareholder
      responses:
        '201':
          description: Links created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  linksCreated:
                    type: array
                    items:
                      $ref: '#/components/schemas/BusinessRelationLink'
                example:
                  status: success
                  linksCreated:
                    - linkedCrmCode: MZ001
                      role: Director
                    - linkedCrmCode: SH002
                      role: Shareholder
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete business relation links
      tags:
        - Business relation links
      security:
        - bearerAuth: []
      parameters:
        - name: crmCode
          in: path
          required: true
          schema:
            type: string
          description: The CRM code of the primary business relation.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessRelationLinkDeleteRequest'
            example:
              - linkedCrmCode: MZ001
                role: Director
              - linkedCrmCode: SH002
                role: Shareholder
      responses:
        '200':
          description: Links deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  deletedLinks:
                    type: array
                    items:
                      type: object
                      properties:
                        linkedCrmCode:
                          type: string
                          example: MZ001
                        role:
                          type: string
                          example: Director
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1.1/business-relations/{crmCode}/aml-kyc-result:
    get:
      summary: Retrieve AML/KYC results for a business relation
      tags:
        - AML/KYC results
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: crmCode
          required: true
          schema:
            type: string
          description: Unique external identifier of the business relation.
      responses:
        '200':
          description: AML/KYC results retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AmlKycResult'
              example:
                amlRiskRating: high
                relationAcceptanceStatus: restricted
                isPep: true
                isSanctioned: false
                kycStatus: to review
                lastKycReviewDate: 2024-11-15
                missingDocuments:
                  - Proof of domicile
                  - Financial statement
                expiredDocuments:
                  - ID card scan
        '401':
          description: Unauthorized - Missing or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '404':
          description: Not Found - Business relation not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Not Found - Business relation with specified crmCode not found"
                code: 404
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1.1/business-relations/{crmCode}/investor-commitments:
    post:
      summary: Register a new fund commitment by an investor
      tags:
        - Investor commitments
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: crmCode
          required: true
          schema:
            type: string
          description: crmCode of the investor (must match an existing business relation)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvestorCommitment'
            example:
              fundId: FUND456
              commitmentAmount: 250000.00
              commitmentCurrency: EUR
              commitmentDate: 2024-12-01
      responses:
        '201':
          description: Commitment successfully recorded
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Commitment registered
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Bad Request - Invalid input"
                code: 400
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '404':
          description: Unknown investor or fund
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Not Found - Business relation with specified crmCode not found"
                code: 404
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'               

  /v1.1/cash-transactions:
    post:
      summary: Submit client cash transactions for AML monitoring
      description: Send a cash transaction for automated AML/KYC evaluation.
      tags:
        - Cash transactions
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/CashTransaction'
            example:
              - crmCode: BR123
                transactionDate: 2024-12-01
                portfolioId: PF-001
                currency: EUR
                amount: 15000.00
                transactionType: subscription
                description: 15,000€ to subscribe in Ishares World R EUR
                externalTransactionId: EXT-TX-78901
                originCountry: LU
                originIban: LU7630006000011234567890189
                destinationCountry: DE
                destinationIban: DE89370400440532013000
      responses:
        '201':
          description: Transactions accepted for analysis
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  receivedCount:
                    type: integer
                    example: 1
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Bad Request - Invalid input"
                code: 400
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '404':
          description: Unknown business relation 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Not Found - Business relation with specified crmCode not found"
                code: 404
        '409':
          description: Duplicate transaction 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Duplicate - Transaction already exists"
                code: 409                
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'  

  /v1.1/cash-transactions/{externalTransactionId}/aml-result:
    get:
      summary: Get AML cahsflow monitoring result for a cash transaction
      tags:
        - Cash transactions      
      parameters:
        - name: externalTransactionId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: AML result retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CashFlowResult'
              examples:
                example:
                  value:
                    externalTransactionId: "TX123456789"
                    crmCode: "BR001234"
                    portfolioId: "P123456"
                    transactionDate: "2025-07-31"
                    analysisResult:
                      status: "flagged"
                      riskScore: 76
                      riskLevel: "high"
                      automatedComment: "Frequent transfers to high-risk country. Transaction inconsistent with client profile."
                      screeningHits:
                        - type: "Country Risk"
                          details: "Destination country is on a sanctions list (IR)."
                        - type: "Transaction Pattern"
                          details: "3 similar transfers within the past 7 days."
                    complianceReview:
                      reviewedBy: "compliance_user1"
                      reviewDate: "2025-08-01"
                      status: "under_investigation"
                      comment: "Requested source of funds justification from advisor."
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Bad Request - Invalid input"
                code: 400
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
        '404':
          description: Not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Transaction not found"
                code: 404

  /v1.1/cash-transactions/aml-results:
    get:
      summary: List AML results for a business relation or portfolio
      tags:
        - Cash transactions         
      parameters:
        - name: crmCode
          in: query
          required: false
          schema:
            type: string
        - name: portfolioId
          in: query
          required: false
          schema:
            type: string
        - name: fromDate
          in: query
          schema:
            type: string
            format: date
        - name: toDate
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: List of AML results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CashFlowResult'
              examples:
                example:
                  value:
                    - externalTransactionId: "TX123456789"
                      crmCode: "BR001234"
                      portfolioId: "P123456"
                      transactionDate: "2025-07-31"
                      analysisResult:
                        status: "flagged"
                        riskScore: 76
                        riskLevel: "high"
                        automatedComment: "Frequent transfers to high-risk country."
                        screeningHits:
                          - type: "Country Risk"
                            details: "Destination: Afghanistan (high terror risk)."
                      complianceReview:
                        reviewedBy: "officerA"
                        reviewDate: "2025-08-01"
                        status: "under_investigation"
                        comment: "Pending external justification."

                    - externalTransactionId: "TX654321000"
                      crmCode: "BR001234"
                      portfolioId: "P123456"
                      transactionDate: "2025-07-30"
                      analysisResult:
                        status: "clear"
                        riskScore: 12
                        riskLevel: "low"
                        automatedComment: "Low-value deposit, origin country: LU."
                        screeningHits: []
                      complianceReview: null
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Bad Request - Invalid input"
                code: 400
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Unauthorized - Missing or invalid token"
                code: 401
                